# Load libraries & functions
```{r}
source("libraries.R")
source("functions.R")
```

# Import data
```{r}
# SLA & LDMC-----
sla_ldmc <- read.csv(here::here("./CommonGardenExperiment_2020Data/clean_data/2020_sla_ldmc_clean.csv")) %>%
  dplyr::select(., -c(1:2)) %>%
  dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block")), as.character) %>%
    dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block")), as.factor)

str(sla_ldmc)
sla_ldmc %<>%
  dplyr::mutate(Fam_uniq = paste0(Population, "_", Family))


# LATEX-----
latex <- read.csv(here::here("./CommonGardenExperiment_2020Data/clean_data/2020_latex_clean.csv")) %>%
  dplyr::select(-1) %>%
  dplyr::mutate_at(vars(c(1:7, 9:12, 15, 18, 21)), as.character) %>%
    dplyr::mutate_at(vars(c(1:7, 9:12, 15, 18, 21)), as.factor) %>%
  dplyr::filter(Latex_weight_mg >= 0) %T>% # remove some negative values
  str()

latex %<>%
  dplyr::mutate(Fam_uniq = as.factor(paste0(Population, "_", Family)))

str(latex)


# HERBIVORY-----
herbivory <- read.csv(here::here("./Joined_annual_data/herbivory.csv")) %>%
  dplyr::select(-1) %>%
  dplyr::filter(Year != 2019) %>%
  dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur")), as.character) %>%
    dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur")), as.factor) %T>%
  str()

herbivory %<>%
  dplyr::mutate(Fam_uniq = as.factor(paste0(Population, "_", Family)))



# WEEVIL DAMAGE-----
weevil <- read.csv(here::here("./Joined_annual_data/weevil.csv")) %>%
  dplyr::select(-1) %>%
  dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur")), as.character) %>%
    dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur")), as.factor) %T>%
  str()

weevil %<>%
  dplyr::mutate(Fam_uniq = as.factor(paste0(Population, "_", Family)))
```

# Diagnostics: Traits only measured in 2021
## LDMC
### Gradient
#### City_dist
```{r}
# # Basic data exploration
# plot(LDMC ~ City_dist, data = sla_ldmc) # outlier > 1.5? It's biologically possible though
# plot(LDMC ~ City_dist, data = sla_ldmc %>%
#           dplyr::filter(LDMC < 1))
# 
# boxplot(LDMC ~ Block, data = sla_ldmc)
# boxplot(LDMC ~ Block, data = sla_ldmc %>%
#           dplyr::filter(LDMC < 1))


ldmc_gr_city_m1 <- glmmTMB(sqrt(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             City_dist,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

# DHARMa::simulateResiduals(ldmc_gr_city_m1) %>%
#   plot
# 
# performance::check_model(ldmc_gr_city_m1)
```

#### Urb_score
```{r}
ldmc_gr_usc_m1 <- glmmTMB(sqrt(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             Urb_score,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

DHARMa::simulateResiduals(ldmc_gr_usc_m1) %>%
  plot

performance::check_model(ldmc_gr_usc_m1)
```

### Urban Subtransects
#### City_dist
```{r}
# doesn't converge unless I remove block
ldmc_urbsubs_city_m1 <- glmmTMB(log(LDMC) ~
                             # Block +
                             (1|Population/Family) +
                             City_dist * Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

# DHARMa::simulateResiduals(ldmc_urbsubs_city_m1) %>%
#   plot
# 
# performance::check_model(ldmc_urbsubs_city_m1)
# 
# car::Anova(ldmc_urbsubs_city_m1,
#            type = "III") # interaxn not sig so will use type II SS
# 
# car::Anova(ldmc_urbsubs_city_m1,
#            type = "II") # interaxn not sig



# MAIN EFFECTS MODEL
ldmc_urbsubs_city_m2 <- glmmTMB(log(LDMC) ~
                             # Block +
                             (1|Population/Family) +
                             City_dist + Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)
# DHARMa::simulateResiduals(ldmc_urbsubs_city_m2) %>%
#   plot
# 
# performance::check_model(ldmc_urbsubs_city_m2)
# car::Anova(ldmc_urbsubs_city_m2)
# 
# # COMPARE AIC
# AIC(ldmc_urbsubs_city_m1, ldmc_urbsubs_city_m2) # m2 lower but not by more than 2 AIC
```

#### Urb_score
```{r}
ldmc_urbsubs_usc_m1 <- glmmTMB(log(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             Urb_score * Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

DHARMa::simulateResiduals(ldmc_urbsubs_usc_m1) %>%
  plot

performance::check_model(ldmc_urbsubs_usc_m1)

car::Anova(ldmc_urbsubs_usc_m1,
           type = "III") # interaxn not sig so will use type II SS

car::Anova(ldmc_urbsubs_usc_m1,
           type = "II") # interaxn not sig



# MAIN EFFECTS MODEL
ldmc_urbsubs_usc_m2 <- glmmTMB(log(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             Urb_score + Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)
DHARMa::simulateResiduals(ldmc_urbsubs_usc_m2) %>%
  plot

performance::check_model(ldmc_urbsubs_usc_m2)
car::Anova(ldmc_urbsubs_usc_m2)

# COMPARE AIC
AIC(ldmc_urbsubs_usc_m1, ldmc_urbsubs_usc_m2) # m2 lower but not by more than 2 AIC
```

## SLA
### Gradient
#### City_dist
```{r}
# Basic data exploration
plot(SLA ~ City_dist, data = sla_ldmc) 

boxplot(SLA ~ Block, data = sla_ldmc)

# doesn't converge if I transform SLA to the extent that diagnostics look spotless (only if I remove block). I can also remove most outliers, but then sometimes it doesn't converge either. But if I remove some outliers (only use SLA < 40), anova results still qualitatitvley identical to other situations noted above. So I'll remove Block and transform SLA so I can compare with Urb_score model.
sla_gr_city_m1 <- glmmTMB(SLA^(1/3) ~
                            #Block +
                            (1|Population/Family) +
                            City_dist,
                        data = sla_ldmc,
                        REML = F)

# performance::check_model(sla_gr_city_m1)
# plot(DHARMa::simulateResiduals(sla_gr_city_m1))
# 
# car::Anova(sla_gr_city_m1)
```

#### Urb_score
```{r}
sla_gr_usc_m1 <- glmmTMB(SLA^(1/3) ~
                           # Block +
                            (1|Population/Family) +
                            Urb_score,
                        data = sla_ldmc,
                        REML = F)

# performance::check_model(sla_gr_usc_m1)
# plot(DHARMa::simulateResiduals(sla_gr_usc_m1))
# 
# car::Anova(sla_gr_usc_m1)
```

### Urban Subtransects
#### City_dist
```{r}
sla_urbsubs_city_m1 <- glmmTMB((SLA)^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_city_m1) 
# plot(DHARMa::simulateResiduals(sla_urbsubs_city_m1))
# car::Anova(sla_urbsubs_city_m1)


# MAIN EFFECTS
sla_urbsubs_city_m2 <- glmmTMB((SLA)^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_city_m2) 
# plot(DHARMa::simulateResiduals(sla_urbsubs_city_m2))
# car::Anova(sla_urbsubs_city_m2)
# AIC(sla_urbsubs_city_m1, sla_urbsubs_city_m2) # qualitatively identical but m2 best model
```

#### Urb_score
```{r}
sla_urbsubs_usc_m1 <- glmmTMB((SLA)^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_usc_m1)
# plot(DHARMa::simulateResiduals(sla_urbsubs_usc_m1))
# car::Anova(sla_urbsubs_usc_m1)


# MAIN EFFECTS
sla_urbsubs_usc_m2 <- glmmTMB((SLA)^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_usc_m2)
# plot(DHARMa::simulateResiduals(sla_urbsubs_usc_m2))
# car::Anova(sla_urbsubs_usc_m2)
# AIC(sla_urbsubs_usc_m1, sla_urbsubs_usc_m2) # qualitatively identical but m2 best model
```

## Latex
### Gradient
#### City_dist
```{r}
# Basic data exploration
plot(Latex_weight_mg ~ City_dist, data = latex) 

boxplot(Latex_weight_mg ~ Block, data = latex)

ltx_gr_city_m1 <- glmmTMB(Latex_weight_mg^(1/3) ~
                            Block +
                            (1|Population/Family) +
                            City_dist,
                        data = latex,
                        REML = F)


# performance::check_model(ltx_gr_city_m1)
# plot(DHARMa::simulateResiduals(ltx_gr_city_m1))
# car::Anova(ltx_gr_city_m1)
```

#### Urb_score
```{r}
ltx_gr_usc_m1 <- glmmTMB(Latex_weight_mg^(1/3) ~ Block +
                           (1|Population/Family) +
                           Urb_score,
                        data = latex,
                        REML = F)

performance::check_model(ltx_gr_usc_m1)
plot(DHARMa::simulateResiduals(ltx_gr_usc_m1))
car::Anova(ltx_gr_usc_m1)

```

### Urban Subtransects
#### City_dist
```{r}
ltx_urbsubs_city_m1 <- glmmTMB(Latex_weight_mg^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = latex %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(ltx_urbsubs_city_m1)
# plot(DHARMa::simulateResiduals(ltx_urbsubs_city_m1))
# car::Anova(ltx_urbsubs_city_m1)



# MAIN EFFECTS MODEL
ltx_urbsubs_city_m2 <- glmmTMB(Latex_weight_mg^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = latex %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(ltx_urbsubs_city_m2)
# plot(DHARMa::simulateResiduals(ltx_urbsubs_city_m2))
# car::Anova(ltx_urbsubs_city_m2)

AIC(ltx_urbsubs_city_m1, ltx_urbsubs_city_m2) # m2 best but <2 AIC away
```

#### Urb_score
```{r}
ltx_urbsubs_usc_m1 <- glmmTMB(Latex_weight_mg^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = latex %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(ltx_urbsubs_usc_m1)
# plot(DHARMa::simulateResiduals(ltx_urbsubs_usc_m1))
# car::Anova(ltx_urbsubs_usc_m1)



# MAIN EFFECTS MODEL
ltx_urbsubs_usc_m2 <- glmmTMB(Latex_weight_mg^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = latex %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(ltx_urbsubs_usc_m2)
# plot(DHARMa::simulateResiduals(ltx_urbsubs_usc_m2))
# car::Anova(ltx_urbsubs_usc_m2)

AIC(ltx_urbsubs_usc_m1, ltx_urbsubs_usc_m2) # m1 best
```


# Diagnostics: Traits measured in 2019, 2020, and 2021
## Herbivory: Before flowering- 2020 and 2021 ONLY
### Gradient
#### City_dist
```{r}
# # Basic data exploration
# plot(Herbivory_mean_early ~ City_dist, data = herbivory) 
# 
# boxplot(Herbivory_mean_early ~ Block, data = herbivory) # anything above 0.1 looks like an outlier
# 
# herbiv_e_gr_dist_m1 <- glmmTMB(Herbivory_mean_early^(1/3) ~
#                                  Block +
#                                  Year +
#                                  (1|Population/Family) +
#                                  City_dist,
#                               data = herbivory,
#                               REML = F)
# 
# plot(DHARMa::simulateResiduals(herbiv_e_gr_dist_m1)) # still problematic even after transforming response (and doesn't converge untransformed)
# 
# hist(herbivory$Herbivory_mean_early, breaks = 50) # zero-inflated?
# 
# # try binomial- still problematic
# plot(
#   DHARMa::simulateResiduals(
#     glmmTMB(Herbivory_mean_early ~
#                   Block +
#                   Year +
#                   (1|Population/Family) +
#                   City_dist,
#                 data = herbivory,
#                 family = binomial,
#                 REML = F)
#     )
#   )
# 
# performance::check_model(
#     glmmTMB(Herbivory_mean_early ~
#                   Block +
#                   Year +
#                   (1|Population/Family) +
#                   City_dist,
#                 data = herbivory,
#                 family = binomial,
#                 REML = F)
#     )

# # TRY BETA FAMILY
# herbivory$Herbivory_mean_early_recode <- herbivory$Herbivory_mean_early
# herbivory$Herbivory_mean_early_recode[herbivory$Herbivory_mean_early_recode == 1] <- 0.999999
# herbivory$Herbivory_mean_early_recode[herbivory$Herbivory_mean_early_recode == 0] <- 0.000001
# 
# test1 <- glmmTMB(Herbivory_mean_early_recode  ~
#                    Block +
#                    Year +
#                    (1|Population/Family) +
#                    City_dist,
#                                 data = herbivory,
#                                 family = beta_family(link="logit"),
#                                REML = F)
# performance::check_model(test1) # heavy right tail
# plot(DHARMa::simulateResiduals(test1))


# TRY HURDLE MODEL-----
# first, create new column with 0/1 indicating any herbivory
herbivory %<>%
  mutate(Herbivory_mean_early_binary = case_when(
    Herbivory_mean_early == 0 ~ 0,
    Herbivory_mean_early > 0 ~ 1)
  )

herbiv_e_gr_dist_m1_bin <- glmmTMB(Herbivory_mean_early_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist,
                              data = herbivory,
                       family = binomial,
                              REML = F)

# plot(DHARMa::simulateResiduals(herbiv_e_gr_dist_m1_bin)) # looks great
# 
# car::Anova(herbiv_e_gr_dist_m1_bin)


# quantitative model
herbiv_e_gr_dist_m1_quant <- glmmTMB(log(Herbivory_mean_early) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_early_binary == 1),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# plot(DHARMa::simulateResiduals(herbiv_e_gr_dist_m1_quant)) # looks great
# performance::check_model(herbiv_e_gr_dist_m1_quant) # looks great
# car::Anova(herbiv_e_gr_dist_m1_quant)
```


#### Urb_score
```{r}
# HURDLE MODEL
herbiv_e_gr_usc_m1_bin <- glmmTMB(Herbivory_mean_early_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score,
                              data = herbivory,
                       family = binomial,
                              REML = F)

# plot(DHARMa::simulateResiduals(herbiv_e_gr_usc_m1_bin)) # looks great
# car::Anova(herbiv_e_gr_usc_m1_bin)


# quantitative model
herbiv_e_gr_usc_m1_quant <- glmmTMB(log(Herbivory_mean_early) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_early_binary == 1),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# plot(DHARMa::simulateResiduals(herbiv_e_gr_usc_m1_quant)) # looks great
# performance::check_model(herbiv_e_gr_usc_m1_quant) # looks great
# car::Anova(herbiv_e_gr_usc_m1_quant)
```

### Urban Subtransects
#### City_dist
```{r}
# HURDLE MODEL
herbiv_e_urbsubs_dist_m1_bin <- glmmTMB(Herbivory_mean_early_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist * Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_dist_m1_bin)) # looks great
# car::Anova(herbiv_e_urbsubs_dist_m1_bin)


# quantitative model
herbiv_e_urbsubs_dist_m1_quant <- glmmTMB(log(Herbivory_mean_early) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist * Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_early_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_dist_m1_quant)) # looks great
# car::Anova(herbiv_e_urbsubs_dist_m1_quant)


# MAIN EFFECTS MODELS
## BINARY- doesn't converge unless I remove block or year
## if I remove block, p-value for city_dist stays nearly same. If I remove year, it becomes significantly smaller... If I remove block from full model, it doesn't converge. the full model also has a marginally significant interaction of transect*distance, so I'll just use that one.
herbiv_e_urbsubs_dist_m2_bin <- glmmTMB(Herbivory_mean_early_binary ~
                              Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist + Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_dist_m2_bin)) # looks great
# car::Anova(herbiv_e_urbsubs_dist_m2_bin)



# QUANTITATIVE
herbiv_e_urbsubs_dist_m2_quant <- glmmTMB(log(Herbivory_mean_early) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist + Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_early_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_dist_m2_quant)) # looks great
# 
# AIC(herbiv_e_urbsubs_dist_m1_quant, herbiv_e_urbsubs_dist_m2_quant) # m1 better but <2 AIC apart
```

#### Urb_score
```{r}
# HURDLE MODEL
herbiv_e_urbsubs_usc_m1_bin <- glmmTMB(Herbivory_mean_early_binary ~
                              Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score * Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_usc_m1_bin)) # looks great


# quantitative model
herbiv_e_urbsubs_usc_m1_quant <- glmmTMB(log(Herbivory_mean_early) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score * Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_early_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_usc_m1_quant)) # looks great



# MAIN EFFECTS MODELS
## BINARY
herbiv_e_urbsubs_usc_m2_bin <- glmmTMB(Herbivory_mean_early_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score + Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_usc_m2_bin)) # looks great
# 
# AIC(herbiv_e_urbsubs_usc_m1_bin, herbiv_e_urbsubs_usc_m2_bin) # m2 better but <2 AIC apart



# QUANTITATIVE
herbiv_e_urbsubs_usc_m2_quant <- glmmTMB(log(Herbivory_mean_early) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score + Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_early_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# plot(DHARMa::simulateResiduals(herbiv_e_urbsubs_usc_m2_quant)) # looks great
# AIC(herbiv_e_urbsubs_usc_m1_quant, herbiv_e_urbsubs_usc_m2_quant) # m1 better but <2 AIC apart
```

## Herbivory: After flowering
### Gradient
#### City_dist
```{r}
# OLD DIAGNOSTICS-----
# herbiv_l_gr_dist_m1 <- glmmTMB(Herbivory_mean_late ~ Block + Year + (1|Population/Family) + City_dist,
#                               data = herbivory,
#                               REML = F) # convergence issue
# 
# performance::check_model(herbiv_l_gr_dist_m1) # very right-skewed. try cube root transformation
# 
# performance::check_model(update(herbiv_l_gr_dist_m1, Herbivory_mean_late^(1/3) ~ .)) # still not converging and I think beta is better choice
# 

# BETA FAMILY
# herbivory$Herbivory_mean_late_recode <- herbivory$Herbivory_mean_late
# herbivory$Herbivory_mean_late_recode[herbivory$Herbivory_mean_late_recode == 1] <- 0.999999
# herbivory$Herbivory_mean_late_recode[herbivory$Herbivory_mean_late_recode == 0] <- 0.000001
# 
# test1 <- glmmTMB(Herbivory_mean_late_recode  ~ Block + Year + (1|Population/Family) + City_dist,
#                                 data = herbivory,
#                                 family = beta_family(link="logit"),
#                                REML = F)
# performance::check_model(test1) # heavy right tail


# TRY HURDLE MODEL-----
# first, create new column with 0/1 indicating any herbivory
herbivory %<>%
  mutate(Herbivory_mean_late_binary = case_when(
    Herbivory_mean_late == 0 ~ 0,
    Herbivory_mean_late > 0 ~ 1)
  )

herbiv_l_gr_dist_m1_bin <- glmmTMB(Herbivory_mean_late_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist,
                              data = herbivory,
                       family = binomial,
                              REML = F)

# Check model assumptions
# plot(DHARMa::simulateResiduals(herbiv_l_gr_dist_m1_bin)) # looks good enough
# car::Anova(herbiv_l_gr_dist_m1_bin)


# quantitative model
herbiv_l_gr_dist_m1_quant <- glmmTMB(log(Herbivory_mean_late) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_late_binary == 1),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# Check model assumptions
# plot(DHARMa::simulateResiduals(herbiv_l_gr_dist_m1_quant)) # looks good enough
# 
# performance::check_model(herbiv_l_gr_dist_m1_quant) # looks great
# 
# car::Anova(herbiv_l_gr_dist_m1_quant)

```

#### Urbanization Score
```{r}
# OLD DIAGNOSTICS-----
# test1 <- glmmTMB(Herbivory_mean_late_recode  ~ Block + Year + (1|Population/Family) + Urb_score,
#                                 data = herbivory,
#                                 family = beta_family(link="logit"),
#                                 REML = F)
# performance::check_model(test1) # heavy right tail
# TRY HURDLE MODEL-----
herbiv_l_gr_usc_m1_bin <- glmmTMB(Herbivory_mean_late_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score,
                              data = herbivory,
                       family = binomial,
                              REML = F)

# Check model assumptions
# plot(DHARMa::simulateResiduals(herbiv_l_gr_usc_m1_bin)) # looks good enough
# car::Anova(herbiv_l_gr_usc_m1_bin)


# quantitative model
herbiv_l_gr_usc_m1_quant <- glmmTMB(log(Herbivory_mean_late) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_late_binary == 1),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# Check model assumptions
# plot(DHARMa::simulateResiduals(herbiv_l_gr_usc_m1_quant)) # looks good enough
# 
# performance::check_model(herbiv_l_gr_usc_m1_quant) # looks great
# 
# car::Anova(herbiv_l_gr_usc_m1_quant)
```

### Urban Subtransects
#### City_dist
```{r}
# OLD DIAGNOSTICS-----
# BETA FAMILY
# test1 <- glmmTMB(Herbivory_mean_late_recode  ~ Block + Year + (1|Population/Family) + City_dist * Transect_ID,
#                                 data = herbivory %>%
#                    dplyr::filter(Transect_ID != "Rural"),
#                                 family = beta_family(link="logit"),
#                  REML = F) # not converging. Try taking out block
# 
# 
# performance::check_model(update(test1, . ~ . -Block)) # heavy right tail

# TRY HURDLE MODEL-----
herbiv_l_urbsubs_dist_m1_bin <- glmmTMB(Herbivory_mean_late_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist * Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_dist_m1_bin)) # looks good enough


# quantitative model
herbiv_l_urbsubs_dist_m1_quant <- glmmTMB(log(Herbivory_mean_late) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist * Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_late_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_dist_m1_quant)) # looks good enough



# MAIN EFFECTS MODELS
## BINARY
herbiv_l_urbsubs_dist_m2_bin <- glmmTMB(Herbivory_mean_late_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist + Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_dist_m2_bin)) # looks good enough

AIC(herbiv_l_urbsubs_dist_m1_bin, herbiv_l_urbsubs_dist_m2_bin) # m2 better but <2 AIC apart



# QUANTITATIVE
herbiv_l_urbsubs_dist_m2_quant <- glmmTMB(log(Herbivory_mean_late) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                City_dist + Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_late_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_dist_m2_quant)) # looks good enough

AIC(herbiv_l_urbsubs_dist_m1_quant, herbiv_l_urbsubs_dist_m2_quant) # m2 better but <2 AIC apart

```

#### Urbanization Score
```{r}
# OLD DIAGNOSTICS-----
# BETA FAMILY
# test1 <- glmmTMB(Herbivory_mean_late_recode  ~ Block + Year + (1|Population/Family) + Urb_score * Transect_ID,
#                                 data = herbivory %>%
#                    dplyr::filter(Transect_ID != "Rural"),
#                                 family = beta_family(link="logit"),
#                  REML = F)

# performance::check_model(test1) # heavy right tail

# TRY HURDLE MODEL-----
herbiv_l_urbsubs_usc_m1_bin <- glmmTMB(Herbivory_mean_late_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score * Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_usc_m1_bin)) # looks good enough


# quantitative model
herbiv_l_urbsubs_usc_m1_quant <- glmmTMB(log(Herbivory_mean_late) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score * Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_late_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_usc_m1_quant)) # looks good enough



# MAIN EFFECTS MODELS
## BINARY
herbiv_l_urbsubs_usc_m2_bin <- glmmTMB(Herbivory_mean_late_binary ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score + Transect_ID,
                              data = herbivory %>%
                                dplyr::filter(Transect_ID != "Rural"),
                       family = binomial,
                              REML = F)

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_usc_m2_bin)) # looks good enough

AIC(herbiv_l_urbsubs_usc_m1_bin, herbiv_l_urbsubs_usc_m2_bin) # m2 better but <2 AIC apart



# QUANTITATIVE
herbiv_l_urbsubs_usc_m2_quant <- glmmTMB(log(Herbivory_mean_late) ~
                               Block +
                               Year + 
                               (1|Population/Family) +
                                Urb_score + Transect_ID,
                              data = herbivory %>%
                        dplyr::filter(
                          Herbivory_mean_late_binary == 1 & Transect_ID != "Rural"),
                              REML = F) # log-transformed after looking at untransformed, sqrt, cube root models

# Check model assumptions
plot(DHARMa::simulateResiduals(herbiv_l_urbsubs_usc_m2_quant)) # looks good enough

AIC(herbiv_l_urbsubs_usc_m1_quant, herbiv_l_urbsubs_usc_m2_quant) # m2 better but <2 AIC apart
```

## Weevil scar length- 2020 and 2021 ONLY
### Hurdle models (Binary, then quantitative)
1. Use a binomial model to predict whether the values are 0 or >0, then
2. Use a linear model to model the observed non-zero values 
#### Gradient
##### City_dist
```{r}
# BINARY MODEL-----
# create binary column
weevil$Scar_binary <- weevil$Scar_length_cm
weevil$Scar_binary[weevil$Scar_binary > 0] <- 1


weev_gr_dist_m1_bin <- glmmTMB(Scar_binary ~ Block + Year + (1|Population/Family) + City_dist,
                              data = weevil,
                              family = "binomial"(link = "logit"),
                              REML = F)

performance::check_model(weev_gr_dist_m1_bin)
plot(DHARMa::simulateResiduals(weev_gr_dist_m1_bin)) # looks good



# QUANTITATIVE MODEL-----
# weev_gr_dist_m1_quant <- glmmTMB(Scar_length_cm ~ Block + Year + (1|Population/Family) + City_dist,
#                               data = weevil %>%
#                                 dplyr::filter(Scar_length_cm > 0),
#                               REML = F)
# 
# performance::check_model(weev_gr_dist_m1_quant)
# plot(DHARMa::simulateResiduals(weev_gr_dist_m1_quant)) # right-skew. try sqrt
# 
# performance::check_model(update(weev_gr_dist_m1_quant, sqrt(Scar_length_cm) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_gr_dist_m1_quant, sqrt(Scar_length_cm) ~ .))) # better. Try cube root
# 
# 
# performance::check_model(update(weev_gr_dist_m1_quant, (Scar_length_cm)^(1/3) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_gr_dist_m1_quant, (Scar_length_cm)^(1/3) ~ .))) # looks great


# final model
weev_gr_dist_m1_quant <- glmmTMB(Scar_length_cm^(1/3) ~ Block + Year + (1|Population/Family) + City_dist,
                              data = weevil %>%
                                dplyr::filter(Scar_length_cm > 0),
                              REML = F)

weev_gr_dist_m1_quant %>% car::Anova()
```

##### Urb_score
```{r}
# BINARY MODEL-----
weev_gr_usc_m1_bin <- glmmTMB(Scar_binary ~ Block + Year + (1|Population/Family) + Urb_score,
                              data = weevil,
                              family = "binomial"(link = "logit"),
                              REML = F)

performance::check_model(weev_gr_usc_m1_bin)
plot(DHARMa::simulateResiduals(weev_gr_usc_m1_bin)) # looks good



# QUANTITATIVE MODEL-----
# weev_gr_usc_m1_quant <- glmmTMB(Scar_length_cm ~ Block + Year + (1|Population/Family) + Urb_score,
#                               data = weevil %>%
#                                 dplyr::filter(Scar_length_cm > 0),
#                               REML = F)
# 
# performance::check_model(weev_gr_usc_m1_quant)
# plot(DHARMa::simulateResiduals(weev_gr_usc_m1_quant)) # right-skew. try sqrt
# 
# performance::check_model(update(weev_gr_usc_m1_quant, sqrt(Scar_length_cm) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_gr_usc_m1_quant, sqrt(Scar_length_cm) ~ .))) # better. Try cube root
# 
# 
# performance::check_model(update(weev_gr_usc_m1_quant, (Scar_length_cm)^(1/3) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_gr_usc_m1_quant, (Scar_length_cm)^(1/3) ~ .))) # looks great


# final model
weev_gr_usc_m1_quant <- glmmTMB(Scar_length_cm^(1/3) ~ Block + Year + (1|Population/Family) + Urb_score,
                              data = weevil %>%
                                dplyr::filter(Scar_length_cm > 0),
                              REML = F)

weev_gr_usc_m1_quant %>% car::Anova()
```

#### Urban Subtransects
##### City_dist
```{r}
# BINARY MODEL-----
weev_urbsubs_dist_m1_bin <- glmmTMB(Scar_binary ~ Block + Year + (1|Population/Family) + City_dist * Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Transect_ID != "Rural"),
                              family = "binomial"(link = "logit"),
                              REML = F)

# performance::check_model(weev_urbsubs_dist_m1_bin)
# plot(DHARMa::simulateResiduals(weev_urbsubs_dist_m1_bin)) # looks good

# MAIN EFFECTS
weev_urbsubs_dist_m2_bin <- glmmTMB(Scar_binary ~ Block + Year + (1|Population/Family) + City_dist + Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Transect_ID != "Rural"),
                              family = "binomial"(link = "logit"),
                              REML = F)

# performance::check_model(weev_urbsubs_dist_m2_bin)
# plot(DHARMa::simulateResiduals(weev_urbsubs_dist_m2_bin)) # looks good
# 
# AIC(weev_urbsubs_dist_m1_bin, weev_urbsubs_dist_m2_bin) # m2 better but <2AIC away




# QUANTITATIVE MODEL-----
# weev_urbsubs_dist_m1_quant <- glmmTMB(Scar_length_cm ~ Block + Year + (1|Population/Family) + City_dist * Transect_ID,
#                               data = weevil %>%
#                                 dplyr::filter(Scar_length_cm > 0 & Transect_ID != "Rural"),
#                               REML = F)
# 
# performance::check_model(weev_urbsubs_dist_m1_quant)
# plot(DHARMa::simulateResiduals(weev_urbsubs_dist_m1_quant)) # right-skew. try sqrt
# 
# performance::check_model(update(weev_urbsubs_dist_m1_quant, sqrt(Scar_length_cm) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_urbsubs_dist_m1_quant, sqrt(Scar_length_cm) ~ .))) # better. Try cube root
# 
# 
# performance::check_model(update(weev_urbsubs_dist_m1_quant, (Scar_length_cm)^(1/3) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_urbsubs_dist_m1_quant, (Scar_length_cm)^(1/3) ~ .))) # looks great


# final model
weev_urbsubs_dist_m1_quant <- glmmTMB(Scar_length_cm^(1/3) ~ Block + Year + (1|Population/Family) + City_dist * Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Scar_length_cm > 0 & Transect_ID != "Rural"),
                              REML = F)

# No interaxns sig, so use type II SS
car::Anova(weev_urbsubs_dist_m1_quant, type = "III")
car::Anova(weev_urbsubs_dist_m1_quant, type = "II")



# MAIN EFFECTS MODEL
weev_urbsubs_dist_m2_quant <- glmmTMB(Scar_length_cm^(1/3) ~ Block + Year + (1|Population/Family) + City_dist + Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Scar_length_cm > 0 & Transect_ID != "Rural"),
                              REML = F)
# 
# performance::check_model(weev_urbsubs_dist_m2_quant)
# plot(DHARMa::simulateResiduals(weev_urbsubs_dist_m2_quant)) # looks great
# 
# 
# AIC(weev_urbsubs_dist_m1_quant, weev_urbsubs_dist_m2_quant) # m2 best but <2 AIC away
```

##### Urb_score
```{r}
# BINARY MODEL-----
weev_urbsubs_usc_m1_bin <- glmmTMB(Scar_binary ~ Block + Year + (1|Population/Family) + Urb_score * Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Transect_ID != "Rural"),
                              family = "binomial"(link = "logit"),
                              REML = F)
# 
# performance::check_model(weev_urbsubs_usc_m1_bin)
# plot(DHARMa::simulateResiduals(weev_urbsubs_usc_m1_bin)) # looks good

# MAIN EFFECTS
weev_urbsubs_usc_m2_bin <- glmmTMB(Scar_binary ~ Block + Year + (1|Population/Family) + Urb_score + Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Transect_ID != "Rural"),
                              family = "binomial"(link = "logit"),
                              REML = F)
# 
# performance::check_model(weev_urbsubs_usc_m2_bin)
# plot(DHARMa::simulateResiduals(weev_urbsubs_usc_m2_bin)) # looks good
# 
# AIC(weev_urbsubs_usc_m1_bin, weev_urbsubs_usc_m2_bin) # m2 better but <2AIC away




# QUANTITATIVE MODEL-----
# weev_urbsubs_usc_m1_quant <- glmmTMB(Scar_length_cm ~ Block + Year + (1|Population/Family) + Urb_score * Transect_ID,
#                               data = weevil %>%
#                                 dplyr::filter(Scar_length_cm > 0 & Transect_ID != "Rural"),
#                               REML = F)
# 
# performance::check_model(weev_urbsubs_usc_m1_quant)
# plot(DHARMa::simulateResiduals(weev_urbsubs_usc_m1_quant)) # right-skew. try sqrt
# 
# performance::check_model(update(weev_urbsubs_usc_m1_quant, sqrt(Scar_length_cm) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_urbsubs_usc_m1_quant, sqrt(Scar_length_cm) ~ .))) # better. Try cube root
# 
# 
# performance::check_model(update(weev_urbsubs_usc_m1_quant, (Scar_length_cm)^(1/3) ~ .))
# plot(DHARMa::simulateResiduals(update(weev_urbsubs_usc_m1_quant, (Scar_length_cm)^(1/3) ~ .))) # looks great


# final model
weev_urbsubs_usc_m1_quant <- glmmTMB(Scar_length_cm^(1/3) ~ Block + Year + (1|Population/Family) + Urb_score * Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Scar_length_cm > 0 & Transect_ID != "Rural"),
                              REML = F)

# No interaxns sig, so use type II SS
# car::Anova(weev_urbsubs_usc_m1_quant, type = "III")
# car::Anova(weev_urbsubs_usc_m1_quant, type = "II")



# MAIN EFFECTS MODEL
weev_urbsubs_usc_m2_quant <- glmmTMB(Scar_length_cm^(1/3) ~ Block + Year + (1|Population/Family) + Urb_score + Transect_ID,
                              data = weevil %>%
                                dplyr::filter(Scar_length_cm > 0 & Transect_ID != "Rural"),
                              REML = F)

# performance::check_model(weev_urbsubs_usc_m2_quant)
# plot(DHARMa::simulateResiduals(weev_urbsubs_usc_m2_quant)) # looks great
# 
# 
# AIC(weev_urbsubs_usc_m1_quant, weev_urbsubs_usc_m2_quant) # m2 best but <2 AIC away

```

# Models for use in analysis
## LDMC
```{r}
ldmc_mods <- list(

## City_dist / gradient
ldmc_gr_city_m1 ,

## Urbanization score / gradient
ldmc_gr_usc_m1 ,

## City_dist / urban subtransects
ldmc_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
ldmc_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
ldmc_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
ldmc_urbsubs_usc_m2 # Best model

)


names(ldmc_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## SLA
```{r}
sla_mods <- list(

## City_dist / gradient
sla_gr_city_m1 ,

## Urbanization score / gradient
sla_gr_usc_m1,

## City_dist / urban subtransects
sla_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
sla_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
sla_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
sla_urbsubs_usc_m2 # Best model

)


names(sla_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## Latex
```{r}
latex_mods <- list(

## City_dist / gradient
ltx_gr_city_m1 ,

## Urbanization score / gradient
ltx_gr_usc_m1,

## City_dist / urban subtransects
ltx_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
ltx_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
ltx_urbsubs_usc_m1 # Best model
)

names(latex_mods) <- c("City_gr", "Usc_gr", "City_urbsubs_alt", "City_urbsubs_best", "Usc_urbsubs")
```

## Herbivory: Early- Hurdle models (Binomial and gaussian families)
```{r}
herb_early_mods_binomial <- list(

## City_dist / gradient
herbiv_e_gr_dist_m1_bin ,

## Urbanization score / gradient
herbiv_e_gr_usc_m1_bin,

## City_dist / urban subtransects
herbiv_e_urbsubs_dist_m1_bin, # Best model

## Urbanization score  / urban subtransects
herbiv_e_urbsubs_usc_m1_bin, # Qualitatively identical model (<2 AIC away)
herbiv_e_urbsubs_usc_m2_bin # Best model
)

names(herb_early_mods_binomial) <- c("City_gr",
                            "Usc_gr",
                            "City_urbsubs_best",
                            "Usc_urbsubs_alt",
                            "Usc_urbsubs_best")



herb_early_mods_quant <- list(

## City_dist / gradient
herbiv_e_gr_dist_m1_quant ,

## Urbanization score / gradient
herbiv_e_gr_usc_m1_quant,

## City_dist / urban subtransects
herbiv_e_urbsubs_dist_m1_quant, # Best model
herbiv_e_urbsubs_dist_m2_quant, # Qualitatively identical model (<2 AIC away)

## Urbanization score  / urban subtransects
herbiv_e_urbsubs_usc_m1_quant, # Best model
herbiv_e_urbsubs_usc_m2_quant # Qualitatively identical model (<2 AIC away)
)

names(herb_early_mods_quant) <- c("City_gr",
                            "Usc_gr",
                            "City_urbsubs_best",
                            "City_urbsubs_alt",
                            "Usc_urbsubs_best",
                            "Usc_urbsubs_alt")
```


## Herbivory: Late- Hurdle models (Binomial and gaussian families)
```{r}
herb_late_mods_binomial <- list(

## City_dist / gradient
herbiv_l_gr_dist_m1_bin ,

## Urbanization score / gradient
herbiv_l_gr_usc_m1_bin,

## City_dist / urban subtransects
herbiv_l_urbsubs_dist_m1_bin, # Qualitatively identical model (<2 AIC away)
herbiv_l_urbsubs_dist_m2_bin, # Best model

## Urbanization score  / urban subtransects
herbiv_l_urbsubs_usc_m1_bin, # Qualitatively identical model (<2 AIC away)
herbiv_l_urbsubs_usc_m2_bin # Best model
)

names(herb_late_mods_binomial) <- c("City_gr",
                            "Usc_gr",
                            "City_urbsubs_alt",
                            "City_urbsubs_best",
                            "Usc_urbsubs_alt",
                            "Usc_urbsubs_best")



herb_late_mods_quant <- list(

## City_dist / gradient
herbiv_l_gr_dist_m1_quant ,

## Urbanization score / gradient
herbiv_l_gr_usc_m1_quant,

## City_dist / urban subtransects
herbiv_l_urbsubs_dist_m1_quant  , # Qualitatively identical model (<2 AIC away)
herbiv_l_urbsubs_dist_m2_quant  , # Best model

## Urbanization score  / urban subtransects
herbiv_l_urbsubs_usc_m1_quant, # Qualitatively identical model (<2 AIC away)
herbiv_l_urbsubs_usc_m2_quant # Best model
)

names(herb_late_mods_quant) <- c("City_gr",
                            "Usc_gr",
                            "City_urbsubs_alt",
                            "City_urbsubs_best",
                            "Usc_urbsubs_alt",
                            "Usc_urbsubs_best")
```


## Weevil Scar- Hurdle models (Binomial and gaussian families)
```{r}
weev_mods_binomial <- list(

## City_dist / gradient
weev_gr_dist_m1_bin ,

## Urbanization score / gradient
weev_gr_usc_m1_bin,

## City_dist / urban subtransects
weev_urbsubs_dist_m1_bin, # Qualitatively identical model (<2 AIC away)
weev_urbsubs_dist_m2_bin, # Best model

## Urbanization score  / urban subtransects
weev_urbsubs_usc_m1_bin , # Qualitatively identical model (<2 AIC away)
weev_urbsubs_usc_m2_bin # Best model
)

names(weev_mods_binomial) <- c("City_gr",
                      "Usc_gr",
                      "City_urbsubs_alt",
                      "City_urbsubs_best",
                      "Usc_urbsubs_alt",
                      "Usc_urbsubs_best")




weev_mods_quant <- list(

## City_dist / gradient
weev_gr_dist_m1_quant ,

## Urbanization score / gradient
weev_gr_usc_m1_quant,

## City_dist / urban subtransects
weev_urbsubs_dist_m1_quant, # Qualitatively identical model (<2 AIC away)
weev_urbsubs_dist_m2_quant, # Best model

## Urbanization score  / urban subtransects
weev_urbsubs_usc_m1_quant , # Qualitatively identical model (<2 AIC away)
weev_urbsubs_usc_m2_quant # Best model
)

names(weev_mods_quant) <- c("City_gr",
                      "Usc_gr",
                      "City_urbsubs_alt",
                      "City_urbsubs_best",
                      "Usc_urbsubs_alt",
                      "Usc_urbsubs_best")
```

