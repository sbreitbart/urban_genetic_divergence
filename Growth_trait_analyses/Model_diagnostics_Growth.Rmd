# Load libraries & functions
```{r}
source("libraries.R")
source("functions.R")
```

# Import data
```{r}
sla_ldmc <- read.csv(here::here("./CommonGardenExperiment_2020Data/clean_data/2020_sla_ldmc_clean.csv")) %>%
  dplyr::select(., -c(1:2)) %>%
  dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Transect_ID", "Urb_Rur", "Patch_ID")), as.character) %>%
    dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Transect_ID", "Urb_Rur", "Patch_ID")), as.factor) %>%
  dplyr::mutate(Fam_uniq = paste0(Population, "_", Family))


heights <- read.csv(here::here("./Joined_annual_data/heights.csv"), na.strings=c("NO PLANT", "none"), blank.lines.skip=TRUE, header=TRUE, sep=",") %>%
  dplyr::select(., -1) %>%
  dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur", "Pop_ID", "Patch_ID")), as.character) %>%
    dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur", "Pop_ID", "Patch_ID")), as.factor) %>%
  dplyr::mutate_at(vars(c("rel_growth_rate")), as.numeric) %>%
  dplyr::mutate(Fam_uniq = paste0(Population, "_", Family))

str(heights)



survival <- read.csv(here::here("./Joined_annual_data/survival.csv"), na.strings=c("NO PLANT", "none"), blank.lines.skip=TRUE, header=TRUE, sep=",") %>%
  dplyr::select(., -1) %>%
  dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur", "Pop_ID", "Patch_ID", "Dead")), as.character) %>%
    dplyr::mutate_at(vars(c("Population", "Family", "Replicate", "Block", "Year", "Transect_ID", "Urb_Rur", "Pop_ID", "Patch_ID", "Dead")), as.factor)%>%
  dplyr::mutate(Fam_uniq = as.factor(paste0(Population, "_", Family)))

str(survival)

```

# Diagnostics
## LDMC
### Gradient
#### City_dist
```{r}
# # Basic data exploration
# plot(LDMC ~ City_dist, data = sla_ldmc) # outlier > 1.5? It's biologically possible though
# plot(LDMC ~ City_dist, data = sla_ldmc %>%
#           dplyr::filter(LDMC < 1))
# 
# boxplot(LDMC ~ Block, data = sla_ldmc)
# boxplot(LDMC ~ Block, data = sla_ldmc %>%
#           dplyr::filter(LDMC < 1))

# doesn't converge if log or cube root transformed
ldmc_gr_city_m1 <- glmmTMB(sqrt(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             City_dist,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

# DHARMa::simulateResiduals(ldmc_gr_city_m1) %>%
#   plot
# performance::check_model(ldmc_gr_city_m1)



# test for gxe intxns
# gxe_test_ldmc <- glmmTMB(sqrt(LDMC) ~
#                              City_dist*Block +
#                              (1|Population/Family),
#                          data = sla_ldmc %>%
#                              dplyr::filter(LDMC < 1),
#                         REML = F)
# 
# test_gxe(ldmc_gr_city_m1, gxe_test_ldmc) # reg mod best
```

#### Urb_score
```{r}
ldmc_gr_usc_m1 <- glmmTMB(sqrt(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             Urb_score,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

# DHARMa::simulateResiduals(ldmc_gr_usc_m1) %>%
#   plot
# performance::check_model(ldmc_gr_usc_m1)


# test for gxe intxns
# gxe_test_ldmc2 <- glmmTMB(sqrt(LDMC) ~
#                              Urb_score*Block +
#                              (1|Population/Family),
#                          data = sla_ldmc %>%
#                              dplyr::filter(LDMC < 1),
#                         REML = F)
# 
# test_gxe(ldmc_gr_usc_m1, gxe_test_ldmc2) # reg mod best
```

### Urban Subtransects
#### City_dist
```{r}
# doesn't converge unless I remove block
ldmc_urbsubs_city_m1 <- glmmTMB(log(LDMC) ~
                              Block +
                             (1|Population/Family) +
                             City_dist * Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

# DHARMa::simulateResiduals(ldmc_urbsubs_city_m1) %>%
#   plot
# performance::check_model(ldmc_urbsubs_city_m1)



# MAIN EFFECTS MODEL
ldmc_urbsubs_city_m2 <- glmmTMB(log(LDMC) ~
                           #   Block +
                             (1|Population/Family) +
                             City_dist + Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)
# DHARMa::simulateResiduals(ldmc_urbsubs_city_m2) %>%
#   plot
# 
# performance::check_model(ldmc_urbsubs_city_m2)
# car::Anova(ldmc_urbsubs_city_m2)
# 
# # COMPARE AIC
# AIC(ldmc_urbsubs_city_m1, ldmc_urbsubs_city_m2) # m2 lower but not by more than 2 AIC


# test for gxe intxns
# gxe_test_ldmc3 <- glmmTMB(log(LDMC) ~
#                              City_dist*Block +
#                              (1|Population/Family) +
#                         City_dist*Transect_ID,
#                         sla_ldmc %>%
#                              dplyr::filter(LDMC < 1 &
#                                              Transect_ID != "Rural"), 
#                         REML = F)
# 
# 
# test_gxe(ldmc_urbsubs_city_m1, gxe_test_ldmc3) # reg model best (I added block back to it)
```

#### Urb_score
```{r}
ldmc_urbsubs_usc_m1 <- glmmTMB(log(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             Urb_score * Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)

# DHARMa::simulateResiduals(ldmc_urbsubs_usc_m1) %>%
#   plot
# performance::check_model(ldmc_urbsubs_usc_m1)


# MAIN EFFECTS MODEL
ldmc_urbsubs_usc_m2 <- glmmTMB(log(LDMC) ~
                             Block +
                             (1|Population/Family) +
                             Urb_score + Transect_ID,
                        data = sla_ldmc %>%
                             dplyr::filter(LDMC < 1 &
                                             Transect_ID != "Rural"), # next highest LMDC is 0.7, so removing the one more than double that
                        REML = F)
# DHARMa::simulateResiduals(ldmc_urbsubs_usc_m2) %>%
#   plot
# performance::check_model(ldmc_urbsubs_usc_m2)
# AIC(ldmc_urbsubs_usc_m1, ldmc_urbsubs_usc_m2) # m2 lower but not by more than 2 AIC


# test for gxe intxns
# gxe_test_ldmc4 <- glmmTMB(log(LDMC) ~
#                              Urb_score*Block +
#                              (1|Population/Family) +
#                         Urb_score*Transect_ID,
#                         sla_ldmc %>%
#                              dplyr::filter(LDMC < 1 &
#                                              Transect_ID != "Rural"),
#                         REML = F)
# 
# 
# test_gxe(ldmc_urbsubs_usc_m1, gxe_test_ldmc4) # reg model best (I added block back to it)
```

## SLA
### Gradient
#### City_dist
```{r}
# Basic data exploration
# plot(SLA ~ City_dist, data = sla_ldmc) 
# 
# boxplot(SLA ~ Block, data = sla_ldmc)

# doesn't converge if I transform SLA to the extent that diagnostics look spotless (only if I remove block). I can also remove most outliers, but then sometimes it doesn't converge either. But if I remove some outliers (only use SLA < 40), anova results still qualitatitvley identical to other situations noted above. So I'll remove Block and transform SLA so I can compare with Urb_score model.
sla_gr_city_m1 <- glmmTMB(SLA^(1/3) ~
                            # Block +
                            (1|Population/Family) +
                            City_dist,
                        data = sla_ldmc,
                        REML = F)

# performance::check_model(sla_gr_city_m1)
# plot(DHARMa::simulateResiduals(sla_gr_city_m1))
# car::Anova(sla_gr_city_m1)


# test for gxe intxns
# gxe_test_sla <- glmmTMB(SLA^(1/3) ~
#                              City_dist*Block +
#                              (1|Population/Family),
#                          data = sla_ldmc ,
#                         REML = F)
# 
# test_gxe(sla_gr_city_m1, gxe_test_sla) # reg mod best (added back block to reg mod)
```

#### Urb_score
```{r}
sla_gr_usc_m1 <- glmmTMB(SLA^(1/3) ~
                    #        Block +
                            (1|Population/Family) +
                            Urb_score,
                        data = sla_ldmc,
                        REML = F)

# performance::check_model(sla_gr_usc_m1)
# plot(DHARMa::simulateResiduals(sla_gr_usc_m1))
# car::Anova(sla_gr_usc_m1)


# test for gxe intxns
# gxe_test_sla2 <- glmmTMB(SLA^(1/3) ~
#                              Urb_score*Block +
#                              (1|Population/Family),
#                          data = sla_ldmc ,
#                         REML = F)
# 
# test_gxe(sla_gr_usc_m1, gxe_test_sla2) # reg mod best (added back block to reg mod)
```

### Urban Subtransects
#### City_dist
```{r}
sla_urbsubs_city_m1 <- glmmTMB(SLA^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_city_m1)
# plot(DHARMa::simulateResiduals(sla_urbsubs_city_m1))
# car::Anova(sla_urbsubs_city_m1)


# MAIN EFFECTS
sla_urbsubs_city_m2 <- glmmTMB(SLA^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_city_m2)
# plot(DHARMa::simulateResiduals(sla_urbsubs_city_m2))
# car::Anova(sla_urbsubs_city_m2)
# AIC(sla_urbsubs_city_m1, sla_urbsubs_city_m2) # qualitatively identical but m2 best model


# test for gxe intxns
# gxe_test_sla3 <- glmmTMB(SLA^(1/3) ~
#                              City_dist*Block +
#                              (1|Population/Family) +
#                         City_dist*Transect_ID,
#                         sla_ldmc %>%
#                              dplyr::filter(Transect_ID != "Rural"),
#                         REML = F)
# 
# 
# test_gxe(sla_urbsubs_city_m1, gxe_test_sla3) # reg model best (I added block back to it)
```

#### Urb_score
```{r}
sla_urbsubs_usc_m1 <- glmmTMB(SLA^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_usc_m1)
# plot(DHARMa::simulateResiduals(sla_urbsubs_usc_m1))
# car::Anova(sla_urbsubs_usc_m1)


# MAIN EFFECTS
sla_urbsubs_usc_m2 <- glmmTMB(SLA^(1/3) ~
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = sla_ldmc %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# performance::check_model(sla_urbsubs_usc_m2)
# plot(DHARMa::simulateResiduals(sla_urbsubs_usc_m2))
# car::Anova(sla_urbsubs_usc_m2)
# AIC(sla_urbsubs_usc_m1, sla_urbsubs_usc_m2) # qualitatively identical but m2 best model


# test for gxe intxns
# gxe_test_sla4 <- glmmTMB(SLA^(1/3) ~
#                              Urb_score*Block +
#                              (1|Population/Family) +
#                         Urb_score*Transect_ID,
#                         sla_ldmc %>%
#                              dplyr::filter(Transect_ID != "Rural"),
#                         REML = F)
# 
# 
# test_gxe(sla_urbsubs_usc_m1, gxe_test_sla4) # reg model best (I added block back to it)
```

## Heights
### Early
#### Gradient
##### City_dist
```{r}
# hist(heights$Total_Height_early, breaks = 80) # zero-inflated?
# 
# boxplot(Total_Height_early ~ Year, data = heights)


height_e_gr_city_m1 <- glmmTMB(Total_Height_early^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = heights,
                        REML = F)


# plot(DHARMa::simulateResiduals(height_e_gr_city_m1))
# performance::check_model(height_e_gr_city_m1)
# car::Anova(height_e_gr_city_m1)


# test for gxe intxns
# gxe_test_height_l <- glmmTMB(Total_Height_early^(1/3) ~ 
#                                  City_dist*Block +
#                                  Year +
#                                  (1|Population/Family) 
#                                  ,
#                         data = heights,
#                         REML = F)
# 
# test_gxe(height_e_gr_city_m1, gxe_test_height_e) # modes stat equivalent
# car::Anova(height_e_gr_city_m1, type = "III") # gxe mod below doesn't have sig gxe intxn but city_dist is marg sig at 0.0560, not sig in reg model
# car::Anova(gxe_test_height_e, type = "III")
```

##### Urb_score
```{r}
height_e_gr_usc_m1 <- glmmTMB(Total_Height_early^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = heights,
                        REML = F)


# plot(DHARMa::simulateResiduals(height_e_gr_usc_m1))
# performance::check_model(height_e_gr_usc_m1)
# car::Anova(height_e_gr_usc_m1)


# test for gxe intxns
# gxe_test_height_e2 <- glmmTMB(Total_Height_early^(1/3) ~
#                                  Urb_score*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  ,
#                         data = heights,
#                         REML = F)
# 
# test_gxe(height_e_gr_usc_m1, gxe_test_height_e2) # mods stat equivalent
# car::Anova(height_e_gr_usc_m1, type = "III") # qualitatively identical results
# car::Anova(gxe_test_height_e2, type = "III")
```

#### Urban Subtransects
##### City_dist
```{r}
# year is adding a lot of variation and complicates model fit. When I treat it as random, model fits MUCH better as per diagnostics, yet anova shows nearly identical results for city_dist and transect_ID so I'll keep it fixed.
height_e_urbsubs_city_m1 <- glmmTMB(Total_Height_early^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_e_urbsubs_city_m1))
# performance::check_model(height_e_urbsubs_city_m1)
# car::Anova(height_e_urbsubs_city_m1)


# MAIN EFFECTS MODEL
height_e_urbsubs_city_m2 <- glmmTMB(Total_Height_early^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_e_urbsubs_city_m2)) 
# performance::check_model(height_e_urbsubs_city_m2)
# car::Anova(height_e_urbsubs_city_m2)
# AIC(height_e_urbsubs_city_m1, height_e_urbsubs_city_m2) # m2 better but <2 AIC from full


# test for gxe intxns
# gxe_test_height_e3 <- glmmTMB(Total_Height_early^(1/3) ~
#                                  City_dist*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  +
#                                  City_dist * Transect_ID,
#                               data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                           REML = F)
# 
# test_gxe(height_e_urbsubs_city_m1, gxe_test_height_e3) # reg mod best
```


##### Urb_score
```{r}
height_e_urbsubs_usc_m1 <- glmmTMB(Total_Height_early^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)


# plot(DHARMa::simulateResiduals(height_e_urbsubs_usc_m1)) 
# performance::check_model(height_e_urbsubs_usc_m1)
# car::Anova(height_e_urbsubs_usc_m1)


# MAIN EFFECTS MODEL
height_e_urbsubs_usc_m2 <- glmmTMB(Total_Height_early^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_e_urbsubs_usc_m2)) 
# performance::check_model(height_e_urbsubs_usc_m2)
# AIC(height_e_urbsubs_usc_m1, height_e_urbsubs_usc_m2) # m2 better but <2 AIC from full


# test for gxe intxns
# gxe_test_height_e4 <- glmmTMB(Total_Height_early^(1/3) ~
#                                  Urb_score*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  +
#                                  Urb_score * Transect_ID,
#                               data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                           REML = F)
# 
# test_gxe(height_e_urbsubs_usc_m1, gxe_test_height_e4) # mods stat equivalent
# car::Anova(gxe_test_height_e4, type = "III") # mods qual identical
# car::Anova(height_e_urbsubs_usc_m1, type = "III")
```

### Late
#### Gradient
##### City_dist
```{r}
height_l_gr_city_m1 <- glmmTMB(Total_Height_late^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = heights,
                        REML = F)

# plot(DHARMa::simulateResiduals(height_l_gr_city_m1)) 
# performance::check_model(height_l_gr_city_m1)
# car::Anova(height_l_gr_city_m1)


# test for gxe intxns
# gxe_test_height_l <- glmmTMB(Total_Height_late^(1/3) ~
#                                  City_dist*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  ,
#                         data = heights,
#                         REML = F)
# 
# test_gxe(height_l_gr_city_m1, gxe_test_height_l) # reg mod best
```

##### Urb_score
```{r}
height_l_gr_usc_m1 <- glmmTMB(Total_Height_late^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = heights,
                        REML = F)

# plot(DHARMa::simulateResiduals(height_l_gr_usc_m1)) 
# performance::check_model(height_l_gr_usc_m1)


# test for gxe intxns
# gxe_test_height_l2 <- glmmTMB(Total_Height_late^(1/3) ~
#                                  Urb_score*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  ,
#                         data = heights,
#                         REML = F)
# 
# test_gxe(height_l_gr_usc_m1, gxe_test_height_l2) # reg mod best
```

#### Urban Subtransects
##### City_dist
```{r}
# again, model fit isn't perfect but it's due to year being so variable. When it's taken out/turned into random effect, diagnostics looks fine and anova result for city_dist nearly identical.
height_l_urbsubs_city_m1 <- glmmTMB(Total_Height_late^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_l_urbsubs_city_m1)) 
# performance::check_model(height_l_urbsubs_city_m1)
# car::Anova(height_l_urbsubs_city_m1)


# MAIN EFFECTS MODEL
height_l_urbsubs_city_m2 <- glmmTMB(Total_Height_late^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_l_urbsubs_city_m2)) 
# performance::check_model(height_l_urbsubs_city_m2)
# AIC(height_l_urbsubs_city_m1, height_l_urbsubs_city_m2) # m2 better but <2 AIC from full


# test for gxe intxns
# gxe_test_height_l3 <- glmmTMB(Total_Height_late^(1/3) ~
#                                  City_dist*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  +
#                                  City_dist * Transect_ID,
#                               data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                           REML = F)
# 
# test_gxe(height_l_urbsubs_city_m1, gxe_test_height_l3) # reg mod best
```

##### Urb_score
```{r}
height_l_urbsubs_usc_m1 <- glmmTMB(Total_Height_late^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_l_urbsubs_usc_m1)) 
# performance::check_model(height_l_urbsubs_usc_m1)



# MAIN EFFECTS MODEL
height_l_urbsubs_usc_m2 <- glmmTMB(Total_Height_late^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)

# plot(DHARMa::simulateResiduals(height_l_urbsubs_usc_m2)) 
# performance::check_model(height_l_urbsubs_usc_m2)
# AIC(height_l_urbsubs_usc_m1, height_l_urbsubs_usc_m2) # m2 better but <2 AIC from full


# test for gxe intxns
# gxe_test_height_l4 <- glmmTMB(Total_Height_late^(1/3) ~
#                                  Urb_score*Block +
#                                  Year +
#                                  (1|Population/Family)
#                                  +
#                                  Urb_score * Transect_ID,
#                               data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                           REML = F)
# 
# test_gxe(height_l_urbsubs_usc_m1, gxe_test_height_l4) # reg mod best
```

## Relative growth rate
### Gradient
#### City_dist
```{r}
# hist(heights$rel_growth_rate, breaks = 80) 
# boxplot(rel_growth_rate ~ Year, data = heights)

rgr_gr_city_m1 <- glmmTMB(rel_growth_rate^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = heights,
                        REML = F)


# plot(DHARMa::simulateResiduals(rgr_gr_city_m1))
# performance::check_model(rgr_gr_city_m1)
# car::Anova(rgr_gr_city_m1)


# test for gxe intxns
# gxe_test_rgr <- glmmTMB(rel_growth_rate^(1/3) ~
#                              City_dist*Block +
#                              (1|Population/Family),
#                          data = heights ,
#                         REML = F)
# 
# test_gxe(rgr_gr_city_m1, gxe_test_rgr) # stat equiv
# car::Anova(gxe_test_rgr, type = "III") # block sig here and not in reg model; otherwise identical (block*city_dist not sig)
# car::Anova(rgr_gr_city_m1, type = "III")
```

#### Urb_score
```{r}
rgr_gr_usc_m1 <- glmmTMB(rel_growth_rate^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = heights,
                        REML = F)


# plot(DHARMa::simulateResiduals(rgr_gr_usc_m1)) 
# performance::check_model(rgr_gr_usc_m1)
# car::Anova(rgr_gr_usc_m1)


# test for gxe intxns
# gxe_test_rgr2 <- glmmTMB(rel_growth_rate^(1/3) ~
#                              Urb_score*Block +
#                              (1|Population/Family),
#                          data = heights ,
#                         REML = F)
# 
# test_gxe(rgr_gr_usc_m1, gxe_test_rgr2) # stat equiv
# car::Anova(gxe_test_rgr2, type = "III") # qual identical results
# car::Anova(rgr_gr_usc_m1, type = "III")
```

### Urban Subtransects
#### City_dist
```{r}
rgr_urbsubs_city_m1 <- glmmTMB(rel_growth_rate^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)


# plot(DHARMa::simulateResiduals(rgr_urbsubs_city_m1))
# performance::check_model(rgr_urbsubs_city_m1)
# car::Anova(rgr_urbsubs_city_m1)


# MAIN EFFECTS MODEL
rgr_urbsubs_city_m2 <- glmmTMB(rel_growth_rate^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)


# plot(DHARMa::simulateResiduals(rgr_urbsubs_city_m2)) # ???
# performance::check_model(rgr_urbsubs_city_m2)
# AIC(rgr_urbsubs_city_m1, rgr_urbsubs_city_m2) #m2 best but <2 AIC from full


# test for gxe intxns
# gxe_test_rgr3 <- glmmTMB(rel_growth_rate ~
#                              City_dist*Block +
#                              (1|Population/Family) +
#                              City_dist*Transect_ID,
#                          data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                          REML = F)
# 
# test_gxe(rgr_urbsubs_city_m1, gxe_test_rgr3) # reg mod best,but the gxe mod wouldn't converge unless I changed the response from ^(1/3) to untransformed
```

#### Urb_score
```{r}
rgr_urbsubs_usc_m1 <- glmmTMB(rel_growth_rate^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)


# plot(DHARMa::simulateResiduals(rgr_urbsubs_usc_m1))
# performance::check_model(rgr_urbsubs_usc_m1)
# car::Anova(rgr_urbsubs_usc_m1)


# MAIN EFFECTS MODEL
rgr_urbsubs_usc_m2 <- glmmTMB(rel_growth_rate^(1/3) ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        REML = F)


# plot(DHARMa::simulateResiduals(rgr_urbsubs_usc_m2))
# performance::check_model(rgr_urbsubs_usc_m2)
# AIC(rgr_urbsubs_usc_m1, rgr_urbsubs_usc_m2) # m2 best but <2 AIC from m2


# test for gxe intxns
# gxe_test_rgr4 <- glmmTMB(rel_growth_rate^(1/3) ~
#                              Urb_score*Block +
#                              (1|Population/Family) +
#                              Urb_score*Transect_ID,
#                          data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                          REML = F)
# 
# test_gxe(rgr_urbsubs_usc_m1, gxe_test_rgr4) # gxe mod best
# car::Anova(rgr_urbsubs_usc_m1, type = "III") # shows urb_score*block intxn is sig (p = 0.035)
# car::Anova(gxe_test_rgr4, type = "III")
```

## Ramets
### Early
#### Gradient
##### City_dist
```{r}
ramets_e_gr_city_m1 <- glmmTMB(Ramets_early ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = heights,
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_e_gr_city_m1)) 
# performance::check_model(ramets_e_gr_city_m1)
# car::Anova(ramets_e_gr_city_m1)


# test for gxe intxns
gxe_test_ramets_e <- glmmTMB(Ramets_early ~
                                 Year +
                                 (1|Population/Family) +
                                 City_dist*Block,
                        data = heights,
                        family = poisson,
                        REML = F)

test_gxe(ramets_e_gr_city_m1, gxe_test_ramets_e) # gxe mod better
car::Anova(gxe_test_ramets_e, type = "III") # block*city_dist  sig at p = 0.0412
car::Anova(ramets_e_gr_city_m1, type = "III")

aov_car(Ramets_early ~
                                 Year +
                                 (1|Population/Family) +
                                 City_dist*Block,
                        data = heights,
                        family = poisson,
                        REML = F)

summary(gxe_test_ramets_e)

```

##### Urb_score
```{r}
ramets_e_gr_usc_m1 <- glmmTMB(Ramets_early ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = heights,
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_e_gr_usc_m1)) 
# performance::check_model(ramets_e_gr_usc_m1)
# car::Anova(ramets_e_gr_usc_m1)


# test for gxe intxns
# gxe_test_ramets_e2 <- glmmTMB(Ramets_early ~
#                                  Year +
#                                  (1|Population/Family) +
#                                  Urb_score*Block,
#                         data = heights,
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_e_gr_usc_m1, gxe_test_ramets_e2) # reg mod best
```

#### Urban Subtransects
##### City_dist
```{r}
ramets_e_urbsubs_city_m1 <- glmmTMB(Ramets_early ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_e_urbsubs_city_m1)) 
# performance::check_model(ramets_e_urbsubs_city_m1)


# MAIN EFFECTS MODEL
ramets_e_urbsubs_city_m2 <- glmmTMB(Ramets_early ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)

# plot(DHARMa::simulateResiduals(ramets_e_urbsubs_city_m2)) 
# performance::check_model(ramets_e_urbsubs_city_m2)
# AIC(ramets_e_urbsubs_city_m1, ramets_e_urbsubs_city_m2) # m2 best but <2 AIC from full


# # test for gxe intxns
# gxe_test_ramets_e3 <- glmmTMB(Ramets_early ~ 
#                                  City_dist*Block +
#                              (1|Population/Family) +
#                              City_dist*Transect_ID,
#                         data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_e_urbsubs_city_m1, gxe_test_ramets_e3) # reg mod best
```

##### Urb_score
```{r}
ramets_e_urbsubs_usc_m1 <- glmmTMB(Ramets_early ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_e_urbsubs_usc_m1))
# performance::check_model(ramets_e_urbsubs_usc_m1)


# MAIN EFFECTS MODEL
ramets_e_urbsubs_usc_m2 <- glmmTMB(Ramets_early ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_e_urbsubs_usc_m2)) 
# performance::check_model(ramets_e_urbsubs_usc_m2)
# AIC(ramets_e_urbsubs_usc_m1, ramets_e_urbsubs_usc_m2) # m2 best but <2 AIC from full


# # test for gxe intxns
# gxe_test_ramets_e4 <- glmmTMB(Ramets_early ~
#                                  Urb_score*Block +
#                              (1|Population/Family) +
#                              Urb_score*Transect_ID,
#                         data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_e_urbsubs_usc_m1, gxe_test_ramets_e4) # reg mod best
```

### Late
#### Gradient
##### City_dist
```{r}
ramets_l_gr_city_m1 <- glmmTMB(Ramets_late ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = heights,
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_l_gr_city_m1)) 
# performance::check_model(ramets_l_gr_city_m1)

# test for gxe intxns
# gxe_test_ramets_l <- glmmTMB(Ramets_late ~
#                                  Year +
#                                  (1|Population/Family) +
#                                  City_dist*Block,
#                         data = heights,
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_l_gr_city_m1, gxe_test_ramets_l) # mods stat equiv
# car::Anova(gxe_test_ramets_l, type = "III") # block*city_dist  not sig, but city_dist is marg sig here but not in reg mod
# car::Anova(ramets_l_gr_city_m1, type = "III")
```

##### Urb_score
```{r}
ramets_l_gr_usc_m1 <- glmmTMB(Ramets_late ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = heights,
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_l_gr_usc_m1)) 
# performance::check_model(ramets_l_gr_usc_m1)


# test for gxe intxns
# gxe_test_ramets_l2 <- glmmTMB(Ramets_late ~
#                                  Year +
#                                  (1|Population/Family) +
#                                  Urb_score*Block,
#                         data = heights,
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_l_gr_usc_m1, gxe_test_ramets_l2) # reg mod best

```

#### Urban Subtransects
##### City_dist
```{r}
ramets_l_urbsubs_city_m1 <- glmmTMB(Ramets_late ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_l_urbsubs_city_m1)) 
# performance::check_model(ramets_l_urbsubs_city_m1)


# MAIN EFFECTS MODEL
ramets_l_urbsubs_city_m2 <- glmmTMB(Ramets_late ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_l_urbsubs_city_m2)) 
# performance::check_model(ramets_l_urbsubs_city_m2)
# AIC(ramets_l_urbsubs_city_m1, ramets_l_urbsubs_city_m2) # m2 best but <2 AIC from full


# # test for gxe intxns
# gxe_test_ramets_l3 <- glmmTMB(Ramets_late ~
#                                  City_dist*Block +
#                              (1|Population/Family) +
#                              City_dist*Transect_ID,
#                         data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_l_urbsubs_city_m1, gxe_test_ramets_l3) # reg mod best
```

##### Urb_score
```{r}
ramets_l_urbsubs_usc_m1 <- glmmTMB(Ramets_late ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_l_urbsubs_usc_m1))
# performance::check_model(ramets_l_urbsubs_usc_m1)


# MAIN EFFECTS MODEL
ramets_l_urbsubs_usc_m2 <- glmmTMB(Ramets_late ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = heights %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(ramets_l_urbsubs_usc_m2)) 
# performance::check_model(ramets_l_urbsubs_usc_m2)
# AIC(ramets_l_urbsubs_usc_m1, ramets_l_urbsubs_usc_m2) # m2 best but <2 AIC from full


# # test for gxe intxns
# gxe_test_ramets_l4 <- glmmTMB(Ramets_late ~
#                                  Urb_score*Block +
#                              (1|Population/Family) +
#                              Urb_score*Transect_ID,
#                         data = heights %>%
#                           dplyr::filter(Transect_ID != "Rural"),
#                         family = poisson,
#                         REML = F)
# 
# test_gxe(ramets_l_urbsubs_usc_m1, gxe_test_ramets_l4) # reg mod best
```

## Mortality
### Regular GLMERs
#### Gradient
##### City_dist
```{r}
# Response: number of seasons alive (1-5)- NOT IN ANALYSIS-----
# seasons survived until death
survival_seasons <- survival %>%
  mutate(seasons = case_when(
    Dead == 1 & Year == 2019 ~ 1,
    Dead == 1 & Year == 2020 ~ 2,
    Dead == 1 & Year == 2021 ~ 3,
    Dead == 1 & Year == 2022 ~ 4,
    TRUE ~ 5)) %>%
  group_by(Row, Column, Population, Block, Family, Replicate, Transect_ID, City_dist, Urb_score, Fam_uniq) %>%
  summarise(seasons = first(seasons)) %>%
  mutate(dead = case_when(
    seasons == 5 ~ 0,
    TRUE ~ 1
  ))

surv_gr_city_m1_seasons <- glmmTMB(seasons ~ 
                                 Block +
                                 (1|Population/Family) +
                                 City_dist,
                        data = survival_seasons ,
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_city_m1_seasons))
# performance::check_model(surv_gr_city_m1_seasons)
# car::Anova(surv_gr_city_m1_seasons)

# Response: 0 or 1, as dead/alive-----
# 2019
surv_gr_city_m1_19 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = survival %>%
                          dplyr::filter(Year == "2019"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_city_m1_19))
# performance::check_model(surv_gr_city_m1_19)
# car::Anova(surv_gr_city_m1_19)


# 2020
surv_gr_city_m1_20 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = survival %>%
                          dplyr::filter(Year == "2020"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_city_m1_20))
# performance::check_model(surv_gr_city_m1_20)
# car::Anova(surv_gr_city_m1_20)


# 2021
surv_gr_city_m1_21 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = survival %>%
                          dplyr::filter(Year == "2021"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_city_m1_21))
# performance::check_model(surv_gr_city_m1_21)
# car::Anova(surv_gr_city_m1_21)

# 2022
surv_gr_city_m1_22 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = survival %>%
                          dplyr::filter(Year == "2022"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_city_m1_22))
# performance::check_model(surv_gr_city_m1_22)
# car::Anova(surv_gr_city_m1_22)

# 2019-2022
surv_gr_city_m1_all <- glmmTMB(Dead ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist,
                        data = survival ,
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_city_m1_all))
# performance::check_model(surv_gr_city_m1_all)
# car::Anova(surv_gr_city_m1_all)


# # test for gxe intxns
# gxe_test_mort <- glmmTMB(Dead ~ 
#                            Year +
#                                  (1|Population/Family) +
#                                  City_dist*Block,
#                         data = survival ,
#                         family = binomial,
#                         REML = F)
# 
# test_gxe(surv_gr_city_m1_all, gxe_test_mort) # reg mod best
```

##### Urb_score
```{r}
# Response: number of seasons alive (1-5)- NOT IN ANALYSIS-----
# seasons survived until death

surv_gr_usc_m1_seasons <- glmmTMB(seasons ~ 
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = survival_seasons ,
                        family = poisson,
                        REML = F)

# 
# plot(DHARMa::simulateResiduals(surv_gr_usc_m1_seasons))
# performance::check_model(surv_gr_usc_m1_seasons)
# car::Anova(surv_gr_usc_m1_seasons)

# Response: 0 or 1, as dead/alive-----
# 2019
surv_gr_usc_m1_19 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = survival %>%
                          dplyr::filter(Year == "2019"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_usc_m1_19))
# performance::check_model(surv_gr_usc_m1_19)
# car::Anova(surv_gr_usc_m1_19)


# 2020
surv_gr_usc_m1_20 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = survival %>%
                          dplyr::filter(Year == "2020"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_usc_m1_20))
# performance::check_model(surv_gr_usc_m1_20)
# car::Anova(surv_gr_usc_m1_20)


# 2021
surv_gr_usc_m1_21 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = survival %>%
                          dplyr::filter(Year == "2021"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_usc_m1_21))
# performance::check_model(surv_gr_usc_m1_21)
# car::Anova(surv_gr_usc_m1_21)

# 2021
surv_gr_usc_m1_22 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = survival %>%
                          dplyr::filter(Year == "2022"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_usc_m1_22))
# performance::check_model(surv_gr_usc_m1_22)
# car::Anova(surv_gr_usc_m1_22)


# 2019-2022
surv_gr_usc_m1_all <- glmmTMB(Dead ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score,
                        data = survival ,
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_gr_usc_m1_all))
# performance::check_model(surv_gr_usc_m1_all)
# car::Anova(surv_gr_usc_m1_all)


# # test for gxe intxns
# gxe_test_mort2 <- glmmTMB(Dead ~
#                            Year +
#                                  (1|Population/Family) +
#                                  Urb_score*Block,
#                         data = survival ,
#                         family = binomial,
#                         REML = F)
# 
# test_gxe(surv_gr_usc_m1_all, gxe_test_mort2) # reg mod best
```

#### Urban Subtransects
##### City_dist
```{r}
# Response: number of seasons alive (1-5)- NOT IN ANALYSIS-----
# seasons survived until death

## full model
surv_urbsubs_city_m1_seasons <- glmmTMB(seasons ~ 
                                 Block +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = survival_seasons %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m1_seasons))
# performance::check_model(surv_urbsubs_city_m1_seasons)
# car::Anova(surv_urbsubs_city_m1_seasons)

## ME model
surv_urbsubs_city_m2_seasons <- glmmTMB(seasons ~ 
                                 Block +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = survival_seasons %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m2_seasons))
# performance::check_model(surv_urbsubs_city_m2_seasons)
# car::Anova(surv_urbsubs_city_m2_seasons)
# AIC(surv_urbsubs_city_m1_seasons,
#     surv_urbsubs_city_m2_seasons) # ME mod is best model although <2 AIC from full.


# Response: 0 or 1, as dead/alive-----
## 2019
## Full model
surv_urbsubs_city_m1_19 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2019" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m1_19))
# performance::check_model(surv_urbsubs_city_m1_19)
# car::Anova(surv_urbsubs_city_m1_19)

## Main effects model
surv_urbsubs_city_m2_19 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2019" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m2_19))
# performance::check_model(surv_urbsubs_city_m2_19)
# car::Anova(surv_urbsubs_city_m2_19)
# AIC(surv_urbsubs_city_m1_19, surv_urbsubs_city_m2_19) # m1 best but <2 AIC from m2

## 2020
## Full model
surv_urbsubs_city_m1_20 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2020" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m1_20))
# performance::check_model(surv_urbsubs_city_m1_20)
# car::Anova(surv_urbsubs_city_m1_20)

## Main effects model
surv_urbsubs_city_m2_20 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2020" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m2_20))
# performance::check_model(surv_urbsubs_city_m2_20)
# car::Anova(surv_urbsubs_city_m2_20)
# AIC(surv_urbsubs_city_m1_20, surv_urbsubs_city_m2_20) # m1 best but <2 AIC from m2
## 2021
## Full model
surv_urbsubs_city_m1_21 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2021" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m1_21))
# car::Anova(surv_urbsubs_city_m1_21)

## Main effects model
surv_urbsubs_city_m2_21 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2021" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m2_21))
# car::Anova(surv_urbsubs_city_m2_21)
# AIC(surv_urbsubs_city_m1_21, surv_urbsubs_city_m2_21) # m2 best but <2 AIC from m2

## 2022
## Full model
surv_urbsubs_city_m1_22 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2022" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m1_22))
# car::Anova(surv_urbsubs_city_m1_22)

## Main effects model
surv_urbsubs_city_m2_22 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2022" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m2_22))
# car::Anova(surv_urbsubs_city_m2_22)
# AIC(surv_urbsubs_city_m1_22, surv_urbsubs_city_m2_22) # m2 best but <2 AIC from m2


## all years
## Full model
surv_urbsubs_city_m1_all <- glmmTMB(Dead ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m1_all))
# car::Anova(surv_urbsubs_city_m1_all) # intxn marg sig

## Main effects model
surv_urbsubs_city_m2_all <- glmmTMB(Dead ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 City_dist + Transect_ID,
                        data = survival %>%
                          dplyr::filter( Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_city_m2_all))
# car::Anova(surv_urbsubs_city_m2_all)
# AIC(surv_urbsubs_city_m1_all, surv_urbsubs_city_m2_all) # m1 best but <2 AIC from m2


# test for gxe intxns
# gxe_test_mort3 <- glmmTMB(Dead ~
#                            Year +
#                                  (1|Population/Family) +
#                                  City_dist*Block +
#                             City_dist*Transect_ID,
# 
#                           data = survival %>%
#                           dplyr::filter( Transect_ID != "Rural"),
#                           family = binomial,
#                         REML = F)
# 
# test_gxe(surv_urbsubs_city_m1_all, gxe_test_mort3) # reg mod best
```

##### Urb_score
```{r}
# Response: number of seasons alive (1-5)- NOT IN ANALYSIS-----
# seasons survived until death
## full model
surv_urbsubs_usc_m1_seasons <- glmmTMB(seasons ~ 
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = survival_seasons %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m1_seasons))
# performance::check_model(surv_urbsubs_usc_m1_seasons)
# car::Anova(surv_urbsubs_usc_m1_seasons)

## ME model
surv_urbsubs_usc_m2_seasons <- glmmTMB(seasons ~ 
                                 Block +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = survival_seasons %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = poisson,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m2_seasons))
# performance::check_model(surv_urbsubs_usc_m2_seasons)
# car::Anova(surv_urbsubs_usc_m2_seasons)
# AIC(surv_urbsubs_usc_m1_seasons,
#     surv_urbsubs_usc_m2_seasons) # ME mod is best model although <2 AIC from full


# Response: 0 or 1, as dead/alive-----
# 2019
## Full model
surv_urbsubs_usc_m1_19 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2019" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m1_19))
# performance::check_model(surv_urbsubs_usc_m1_19)
# car::Anova(surv_urbsubs_usc_m1_19)

## Main effects model
surv_urbsubs_usc_m2_19 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2019" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m2_19))
# performance::check_model(surv_urbsubs_usc_m2_19)
# car::Anova(surv_urbsubs_usc_m2_19)
# AIC(surv_urbsubs_usc_m1_19, surv_urbsubs_usc_m2_19) # m2 best but <2 AIC from m1

# 2020
## Full model
surv_urbsubs_usc_m1_20 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2020" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m1_20))
# performance::check_model(surv_urbsubs_usc_m1_20)
# car::Anova(surv_urbsubs_usc_m1_20)

## Main effects model
surv_urbsubs_usc_m2_20 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2020" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m2_20))
# performance::check_model(surv_urbsubs_usc_m2_20)
# car::Anova(surv_urbsubs_usc_m2_20)
# AIC(surv_urbsubs_usc_m1_20, surv_urbsubs_usc_m2_20) # m1 best but <2 AIC from m2

# 2021
## Full model
surv_urbsubs_usc_m1_21 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2021" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m1_21))
# car::Anova(surv_urbsubs_usc_m1_21)

## Main effects model
surv_urbsubs_usc_m2_21 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2021" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m2_21))
# car::Anova(surv_urbsubs_usc_m2_21)
# AIC(surv_urbsubs_usc_m1_21, surv_urbsubs_usc_m2_21) # m1 best but <2 AIC from m2


# 2022
## Full model
surv_urbsubs_usc_m1_22 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2022" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m1_22))
# car::Anova(surv_urbsubs_usc_m1_22)

## Main effects model
surv_urbsubs_usc_m2_22 <- glmmTMB(Dead ~ 
                                 Block +
                            #     Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = survival %>%
                          dplyr::filter(Year == "2022" & Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m2_22))
# car::Anova(surv_urbsubs_usc_m2_22)
# AIC(surv_urbsubs_usc_m1_22, surv_urbsubs_usc_m2_22) # m1 best but <2 AIC from m2



# all years
## Full model
surv_urbsubs_usc_m1_all <- glmmTMB(Dead ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score * Transect_ID,
                        data = survival %>%
                          dplyr::filter(Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m1_all))
# car::Anova(surv_urbsubs_usc_m1_all)

## Main effects model
surv_urbsubs_usc_m2_all <- glmmTMB(Dead ~ 
                                 Block +
                                 Year +
                                 (1|Population/Family) +
                                 Urb_score + Transect_ID,
                        data = survival %>%
                          dplyr::filter( Transect_ID != "Rural"),
                        family = binomial,
                        REML = F)


# plot(DHARMa::simulateResiduals(surv_urbsubs_usc_m2_all))
# car::Anova(surv_urbsubs_usc_m2_all)
# AIC(surv_urbsubs_usc_m1_all, surv_urbsubs_usc_m2_all) # m1 best but <2 AIC from m2


# # test for gxe intxns
gxe_test_mort4 <- glmmTMB(Dead ~
                           Year +
                                 (1|Population/Family) +
                                 Urb_score*Block +
                            Urb_score*Transect_ID,

                          data = survival %>%
                          dplyr::filter( Transect_ID != "Rural"),
                          family = binomial,
                        REML = F)

test_gxe(surv_urbsubs_usc_m1_all, gxe_test_mort4) # stat equiv
car::Anova(gxe_test_mort4, type = "III") # city*block marg sig
car::Anova(surv_urbsubs_usc_m1_all, type = "III")
```

### Cox proportional hazards regressions
#### Gradient
##### City_dist
```{r}
# # install.packages("survival")
# library(survival)
# coxph(Surv(seasons, dead) ~
#             #    (1|Population/Family) +
#                 Block + City_dist,
#       data = survival_seasons) %T>% 
#   summary() # doesn't work with random effect

mortality_mod1 <- coxme(Surv(seasons, dead) ~
                (1|Population/Family) +
                Block + City_dist,
      data = survival_seasons) 
# mortality_mod1

# sjPlot::plot_model(mortality_mod1)
```

##### Urb_score
```{r}
mortality_mod2 <- coxme(Surv(seasons, dead) ~
                (1|Population/Family) +
                Block + Urb_score,
      data = survival_seasons)

# sjPlot::plot_model(mortality_mod2)
```

#### Urban Subtransects
##### City_dist
```{r}
surv_transects <- droplevels(
  subset(
    survival_seasons,
    !Transect_ID %in% "Rural"))

mortality_mod3 <- coxme(Surv(seasons, dead) ~
        (1|Population/Family) +
        Block +
        City_dist * Transect_ID,
      data = surv_transects) 
# mortality_mod3
# summary(mortality_mod3)

# sjPlot::plot_model(mortality_mod3,
#                     vline.color = "grey",
#                    sort.est = TRUE,
#                    show.values = TRUE,
#                    value.offset = .3,
#                    rm.terms = c("Block [3]",
#                                 "Block [2]",
#                                 "Block [4]"),
#                     transform = "plogis")

pop_mort_estimates <- ranef(mortality_mod3)$Population %>%
  as.data.frame()%>%
  tibble::rownames_to_column("Population") %>%
  dplyr::rename(estimate = 2) %>%
  left_join(., surv_transects %>% # add city_dist and other variables
              dplyr::select(c(3, 7:9)) %>%
              dplyr::group_by(Population) %>%
              dplyr::summarise(Population = first(Population),
                               Transect_ID = first(Transect_ID),
                               City_dist = first(City_dist),
                               Urb_score = first(Urb_score)))

# ggplot(pop_mort_estimates) +
#        aes(City_dist, estimate,
#            color = Transect_ID,
#            fill = Transect_ID) +
#          geom_point() +
#   geom_smooth(method = "lm") +
#   theme_minimal()
```

##### Urb_score
```{r}
mortality_mod4 <- coxme(Surv(seasons, dead) ~
        (1|Population/Family) +
        Block +
        Urb_score * Transect_ID,
      data = surv_transects) 
# mortality_mod4

# sjPlot::plot_model(mortality_mod4,
#                     vline.color = "grey",
#                    sort.est = TRUE,
#                    show.values = TRUE,
#                    value.offset = .3,
#                    rm.terms = c("Block [3]",
#                                 "Block [2]",
#                                 "Block [4]"),
#                     transform = "plogis")


# ggplot(pop_mort_estimates) +
#        aes(Urb_score, estimate,
#            color = Transect_ID,
#            fill = Transect_ID) +
#          geom_point() +
#   geom_smooth(method = "lm") +
#   xlim(4, -2) +
#   theme_minimal()
```

# Models for use in analysis
## LDMC
```{r}
ldmc_mods <- list(

## City_dist / gradient
ldmc_gr_city_m1 ,

## Urbanization score / gradient
ldmc_gr_usc_m1 ,

## City_dist / urban subtransects
ldmc_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
ldmc_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
ldmc_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
ldmc_urbsubs_usc_m2 # Best model

)


names(ldmc_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## SLA
```{r}
sla_mods <- list(

## City_dist / gradient
sla_gr_city_m1 ,

## Urbanization score / gradient
sla_gr_usc_m1,

## City_dist / urban subtransects
sla_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
sla_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
sla_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
sla_urbsubs_usc_m2 # Best model

)


names(sla_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## Heights- early
```{r}
heights_early_mods <- list(

## City_dist / gradient
height_e_gr_city_m1 ,

## Urbanization score / gradient
height_e_gr_usc_m1 ,

## City_dist / urban subtransects
height_e_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
height_e_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
height_e_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
height_e_urbsubs_usc_m2 # Best model

)


names(heights_early_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## Heights- late
```{r}
heights_late_mods <- list(

## City_dist / gradient
height_l_gr_city_m1 ,

## Urbanization score / gradient
height_l_gr_usc_m1 ,

## City_dist / urban subtransects
height_l_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
height_l_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
height_l_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
height_l_urbsubs_usc_m2 # Best model

)


names(heights_late_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```


## Relative growth rate
```{r}
rgr_mods <- list(

## City_dist / gradient
rgr_gr_city_m1 ,

## Urbanization score / gradient
rgr_gr_usc_m1 ,

## City_dist / urban subtransects
rgr_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
rgr_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
rgr_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
rgr_urbsubs_usc_m2 # Best model
)


names(rgr_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## Ramets: Early
```{r}
ramets_early_mods <- list(

## City_dist / gradient
ramets_e_gr_city_m1 ,

## Urbanization score / gradient
ramets_e_gr_usc_m1,

## City_dist / urban subtransects
ramets_e_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
ramets_e_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
ramets_e_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
ramets_e_urbsubs_usc_m2 # Best model

)


names(ramets_early_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## Ramets: Late
```{r}
ramets_late_mods <- list(

## City_dist / gradient
ramets_l_gr_city_m1 ,

## Urbanization score / gradient
ramets_l_gr_usc_m1 ,

## City_dist / urban subtransects
ramets_l_urbsubs_city_m1, # Qualitatively identical model (<2 AIC away)
ramets_l_urbsubs_city_m2, # Best model

## Urbanization score  / urban subtransects
ramets_l_urbsubs_usc_m1, # Qualitatively identical model (<2 AIC away)
ramets_l_urbsubs_usc_m2 # Best model

)


names(ramets_late_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_alt",
                     "City_urbsubs_best",
                     "Usc_urbsubs_alt",
                     "Usc_urbsubs_best")
```

## Mortality
```{r}
mortality_mods <- list(

## City_dist / gradient
 surv_gr_city_m1_all,

## Urbanization score / gradient
 surv_gr_usc_m1_all,

## City_dist / urban subtransects
surv_urbsubs_city_m1_all, # Best model
surv_urbsubs_city_m2_all, # Qualitatively identical model (<2 AIC away)

## Urbanization score  / urban subtransects
surv_urbsubs_usc_m1_all,  # Best model
surv_urbsubs_usc_m2_all # Qualitatively identical model (<2 AIC away)

)


names(mortality_mods) <- c("City_gr",
                     "Usc_gr",
                     "City_urbsubs_best",
                     "City_urbsubs_alt",
                    "Usc_urbsubs_best",
                      "Usc_urbsubs_alt")
```

## Create full list
```{r}

all_models <- list(
ldmc_mods,
sla_mods,
heights_early_mods,
heights_late_mods,
rgr_mods,
ramets_early_mods,
ramets_late_mods,
mortality_mods 
)

names(all_models) <- c(
"ldmc_mods",
"sla_mods",
"heights_early_mods",
"heights_late_mods",
"rgr_mods",
"ramets_early_mods",
"ramets_late_mods" ,
"mortality_mods" 
  )
```

## Create separate lists of best vs. alt models for city_dist vs urb_score
### LDMC

```{r}
## Best
### City_dist
ldmc_mods_best_c <- ldmc_mods[c(1,4)]

### Urb_score
ldmc_mods_best_u <- ldmc_mods[c(2,6)]

## Alt
### City_dist
ldmc_mods_alt_c <- ldmc_mods[3]

### Urb_score
ldmc_mods_alt_u <- ldmc_mods[5]
```

### SLA

```{r}
## Best
### City_dist
sla_mods_best_c <- sla_mods[c(1,4)]

### Urb_score
sla_mods_best_u <- sla_mods[c(2,6)]

## Alt
### City_dist
sla_mods_alt_c <- sla_mods[3]

### Urb_score
sla_mods_alt_u <- sla_mods[5]
```

### Heights- Early

```{r}
## Best
### City_dist
heights_early_mods_best_c <- heights_early_mods[c(1,4)]

### Urb_score
heights_early_mods_best_u <- heights_early_mods[c(2,6)]

## Alt
### City_dist
heights_early_mods_alt_c <- heights_early_mods[3]

### Urb_score
heights_early_mods_alt_u <- heights_early_mods[5]
```

### Heights- Late

```{r}
## Best
### City_dist
heights_late_mods_best_c <- heights_late_mods[c(1,4)]

### Urb_score
heights_late_mods_best_u <- heights_late_mods[c(2,6)]

## Alt
### City_dist
heights_late_mods_alt_c <- heights_late_mods[3]

### Urb_score
heights_late_mods_alt_u <- heights_late_mods[5]
```

### Relative growth rate

```{r}
## Best
### City_dist
rgr_mods_best_c <- rgr_mods[c(1,4)]

### Urb_score
rgr_mods_best_u <- rgr_mods[c(2,6)]

## Alt
### City_dist
rgr_mods_alt_c <- rgr_mods[3]

### Urb_score
rgr_mods_alt_u <- rgr_mods[5]
```

### Ramets- Early

```{r}
## Best
### City_dist
ramets_early_mods_best_c <- ramets_early_mods[c(1,4)]

### Urb_score
ramets_early_mods_best_u <- ramets_early_mods[c(2,6)]

## Alt
### City_dist
ramets_early_mods_alt_c <- ramets_early_mods[3]

### Urb_score
ramets_early_mods_alt_u <- ramets_early_mods[5]
```

### Ramets- Late

```{r}
## Best
### City_dist
ramets_late_mods_best_c <- ramets_late_mods[c(1,4)]

### Urb_score
ramets_late_mods_best_u <- ramets_late_mods[c(2,6)]

## Alt
### City_dist
ramets_late_mods_alt_c <- ramets_late_mods[3]

### Urb_score
ramets_late_mods_alt_u <- ramets_late_mods[5]
```

### Mortality

```{r}
## Best
### City_dist
mortality_mods_best_c <- mortality_mods[c(1,3)]

### Urb_score
mortality_mods_best_u <- mortality_mods[c(2,5)]

## Alt
### City_dist
mortality_mods_alt_c <- mortality_mods[4]

### Urb_score
mortality_mods_alt_u <- mortality_mods[6]
```

